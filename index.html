<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>居酒屋注文システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Gothic', 'Hiragino Kaku Gothic Pro', monospace;
            background: #E5E5E5;
            min-height: 100vh;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .slip-container {
            width: 100%;
            max-width: 400px;
            background: #F5F5DC;
            border: 2px solid #999;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .table-section {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-section label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .table-section select {
            width: 120px;
            padding: 6px;
            border: 1px solid #999;
            font-size: 14px;
            background: white;
        }

        /* チビ伝テーブル */
        .order-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            background: #F8F8F0;
        }

        .order-table td {
            border-bottom: 1px solid #999;
            border-right: 1px solid #999;
            padding: 12px 10px;
            font-size: 16px;
            font-family: 'MS Gothic', monospace;
            height: 50px;
            vertical-align: middle;
            position: relative;
        }

        .order-table td:last-child {
            border-right: none;
        }

        .col-name {
            width: 50%;
            cursor: text;
        }

        .col-qty {
            width: 20%;
            text-align: center;
            cursor: text;
        }

        .col-price {
            width: 30%;
            text-align: right;
        }

        .editable-cell {
            background: transparent;
            border: none;
            width: 100%;
            height: 100%;
            font-size: 16px;
            font-family: 'MS Gothic', monospace;
            outline: none;
            padding: 0;
            text-align: inherit;
        }

        .editable-cell.name-input {
            text-align: left;
        }

        .editable-cell.qty-input {
            text-align: center;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #333;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .suggestion-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .suggestion-item:hover {
            background: #f0f0f0;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .total-section {
            text-align: right;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .confirm-section {
            text-align: center;
            margin-top: 20px;
        }

        .confirm-btn {
            background: #8B4513;
            color: white;
            border: 2px solid #8B4513;
            padding: 12px 40px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 4px;
        }

        .confirm-btn:hover {
            background: #A0522D;
            border-color: #A0522D;
        }

        .hidden {
            display: none;
        }

        .active-cell {
            background: #fff !important;
        }
    </style>
</head>
<body>
    <div class="slip-container">
        <div class="table-section">
            <label>テーブル:</label>
            <select id="table-select">
                <option value="">選択</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
            </select>
        </div>

        <table class="order-table">
            <tbody id="order-tbody">
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="0">
                        <div class="suggestions hidden" id="suggestions-0"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="0">
                    </td>
                    <td class="col-price" id="price-0"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="1">
                        <div class="suggestions hidden" id="suggestions-1"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="1">
                    </td>
                    <td class="col-price" id="price-1"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="2">
                        <div class="suggestions hidden" id="suggestions-2"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="2">
                    </td>
                    <td class="col-price" id="price-2"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="3">
                        <div class="suggestions hidden" id="suggestions-3"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="3">
                    </td>
                    <td class="col-price" id="price-3"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="4">
                        <div class="suggestions hidden" id="suggestions-4"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="4">
                    </td>
                    <td class="col-price" id="price-4"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="5">
                        <div class="suggestions hidden" id="suggestions-5"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="5">
                    </td>
                    <td class="col-price" id="price-5"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="6">
                        <div class="suggestions hidden" id="suggestions-6"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="6">
                    </td>
                    <td class="col-price" id="price-6"></td>
                </tr>
                <tr>
                    <td class="col-name">
                        <input type="text" class="editable-cell name-input" placeholder="" data-row="7">
                        <div class="suggestions hidden" id="suggestions-7"></div>
                    </td>
                    <td class="col-qty">
                        <input type="number" class="editable-cell qty-input" min="1" value="" data-row="7">
                    </td>
                    <td class="col-price" id="price-7"></td>
                </tr>
            </tbody>
        </table>

        <div class="total-section">
            合計　<span id="total-amount">0</span>円
        </div>

        <div class="confirm-section">
            <button class="confirm-btn" id="confirm-order">注文</button>
        </div>
    </div>

    <script>
        // サンプルメニューデータ
        const menuData = [
            { name: "ビールアサヒ", price: 600, kana: "びーるあさひ" },
            { name: "キリンビール", price: 600, kana: "きりんびーる" },
            { name: "生ビール", price: 500, kana: "なまびーる" },
            { name: "豚角煮", price: 1200, kana: "ぶたかくに" },
            { name: "三元豚の天ぷら", price: 900, kana: "さんげんぶたのてんぷら" },
            { name: "豚しょうが焼き", price: 850, kana: "ぶたしょうがやき" },
            { name: "枝豆", price: 400, kana: "えだまめ" },
            { name: "エイヒレ", price: 600, kana: "えいひれ" },
            { name: "えのきバター", price: 500, kana: "えのきばたー" },
            { name: "エリンギバター炒め", price: 550, kana: "えりんぎばたーいため" },
            { name: "えびしんじょう", price: 700, kana: "えびしんじょう" },
            { name: "しゅうまい", price: 600, kana: "しゅうまい" },
            { name: "しらす和え", price: 650, kana: "しらすあえ" },
            { name: "しゅんの魚", price: 1200, kana: "しゅんのさかな" },
            { name: "刺身盛り合わせ", price: 1500, kana: "さしみもりあわせ" },
            { name: "唐揚げ", price: 700, kana: "からあげ" },
            { name: "やきとり", price: 200, kana: "やきとり" },
            { name: "焼き魚", price: 900, kana: "やきざかな" },
            { name: "サラダ", price: 500, kana: "さらだ" },
            { name: "冷奴", price: 400, kana: "ひややっこ" },
            { name: "タコの天ぷら", price: 1000, kana: "たこのてんぷら" },
            { name: "アサヒビール", price: 600, kana: "あさひびーる" }
        ];

        let selectedItems = new Array(8).fill(null);

        // 各行の品名入力にイベントリスナーを追加
        document.querySelectorAll('.name-input').forEach((input, index) => {
            input.addEventListener('input', function() {
                handleNameInput(this, index);
            });

            input.addEventListener('focus', function() {
                this.parentElement.classList.add('active-cell');
            });

            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('active-cell');
                setTimeout(() => {
                    document.getElementById(`suggestions-${index}`).classList.add('hidden');
                }, 200);
            });
        });

        // 各行の数量入力にイベントリスナーを追加
        document.querySelectorAll('.qty-input').forEach((input, index) => {
            input.addEventListener('input', function() {
                updateRowPrice(index);
            });

            input.addEventListener('focus', function() {
                this.parentElement.classList.add('active-cell');
            });

            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('active-cell');
            });
        });

        function handleNameInput(input, rowIndex) {
            const query = input.value.toLowerCase();
            const suggestionsDiv = document.getElementById(`suggestions-${rowIndex}`);

            if (query.length === 0) {
                suggestionsDiv.classList.add('hidden');
                selectedItems[rowIndex] = null;
                updateRowPrice(rowIndex);
                return;
            }

            const filteredItems = menuData.filter(item => 
                item.kana.includes(query) || item.name.toLowerCase().includes(query)
            );

            if (filteredItems.length > 0) {
                displaySuggestions(filteredItems, rowIndex);
                suggestionsDiv.classList.remove('hidden');
            } else {
                suggestionsDiv.classList.add('hidden');
                selectedItems[rowIndex] = null;
                updateRowPrice(rowIndex);
            }
        }

        function displaySuggestions(items, rowIndex) {
            const suggestionsDiv = document.getElementById(`suggestions-${rowIndex}`);
            suggestionsDiv.innerHTML = '';
            
            items.forEach(item => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-item';
                suggestionElement.innerHTML = `
                    <span>${item.name}</span>
                    <span>¥${item.price}</span>
                `;
                suggestionElement.addEventListener('mousedown', () => selectMenuItem(item, rowIndex));
                suggestionsDiv.appendChild(suggestionElement);
            });
        }

        function selectMenuItem(item, rowIndex) {
            const nameInput = document.querySelector(`.name-input[data-row="${rowIndex}"]`);
            const qtyInput = document.querySelector(`.qty-input[data-row="${rowIndex}"]`);
            
            nameInput.value = item.name;
            selectedItems[rowIndex] = item;
            
            if (!qtyInput.value) {
                qtyInput.value = 1;
            }
            
            document.getElementById(`suggestions-${rowIndex}`).classList.add('hidden');
            updateRowPrice(rowIndex);
        }

        function updateRowPrice(rowIndex) {
            const qtyInput = document.querySelector(`.qty-input[data-row="${rowIndex}"]`);
            const priceCell = document.getElementById(`price-${rowIndex}`);
            
            if (selectedItems[rowIndex] && qtyInput.value) {
                const total = selectedItems[rowIndex].price * parseInt(qtyInput.value);
                priceCell.textContent = total.toLocaleString();
            } else {
                priceCell.textContent = '';
            }
            
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            for (let i = 0; i < 8; i++) {
                const qtyInput = document.querySelector(`.qty-input[data-row="${i}"]`);
                if (selectedItems[i] && qtyInput.value) {
                    total += selectedItems[i].price * parseInt(qtyInput.value);
                }
            }
            document.getElementById('total-amount').textContent = total.toLocaleString();
        }

        // 注文確定
        document.getElementById('confirm-order').addEventListener('click', () => {
            const tableNumber = document.getElementById('table-select').value;
            if (!tableNumber) {
                alert('テーブル番号を選択してください');
                return;
            }

            const orders = [];
            for (let i = 0; i < 8; i++) {
                const qtyInput = document.querySelector(`.qty-input[data-row="${i}"]`);
                if (selectedItems[i] && qtyInput.value) {
                    orders.push({
                        name: selectedItems[i].name,
                        quantity: parseInt(qtyInput.value),
                        price: selectedItems[i].price
                    });
                }
            }

            if (orders.length === 0) {
                alert('注文商品を入力してください');
                return;
            }

            // 実際の実装では、ここでSquare APIに送信
            const total = document.getElementById('total-amount').textContent;
            alert(`テーブル${tableNumber}の注文を確定しました！\n合計: ${total}円`);
            
            // リセット
            selectedItems = new Array(8).fill(null);
            document.querySelectorAll('.name-input').forEach(input => input.value = '');
            document.querySelectorAll('.qty-input').forEach(input => input.value = '');
            document.querySelectorAll('[id^="price-"]').forEach(cell => cell.textContent = '');
            updateTotal();
            document.getElementById('table-select').value = '';
        });
    </script>
</body>
</html>
